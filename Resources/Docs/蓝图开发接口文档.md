# 蓝图开发接口

## 创建蓝图资产 `blueprint.create`
创建一个新的蓝图资产，支持指定父类、保存路径，以及在创建时直接添加组件。已实现蓝图重名检测，避免覆盖已有资产导致崩溃。

### 请求（JSON-RPC）
```json
{"ver":"1.0","type":"req","id":"bp1","method":"blueprint.create","params":{
  "name":"BP_MyActor",              // 必填，蓝图名称
  "parent_class":"Actor",           // 可选，父类（默认 Actor），支持短名或完整路径
  "path":"/Game/Blueprints/BP_MyActor", // 可选，完整包路径
  "folder":"/Game/Blueprints",      // 可选，保存目录（与 path 二选一，默认 /Game/UnrealAgent/Blueprints）
  "components":[                    // 可选，创建时附带的组件列表
    {
      "component_type":"StaticMeshComponent",
      "component_name":"MyMesh",
      "attach_to":"root",           // 可选，附加到的父组件
      "location":{"x":0,"y":0,"z":100},
      "rotation":{"pitch":0,"yaw":0,"roll":0},
      "scale":{"x":1,"y":1,"z":1},
      "properties":{                // 可选，组件属性
        "CastShadow":true
      }
    }
  ]
}}
```

### 响应
```json
{"ver":"1.0","type":"res","id":"bp1","code":200,"result":{
  "ok":true,
  "name":"BP_MyActor",
  "path":"/Game/Blueprints/BP_MyActor",
  "parent_class":"Actor",
  "generated_class":"/Game/Blueprints/BP_MyActor.BP_MyActor_C",
  "saved":true,
  "components":[
    {"name":"MyMesh","class":"StaticMeshComponent","attach_to":""}
  ],
  "warnings":[]
}}
```

### 说明
- `parent_class` 支持短名（如 `Actor`、`Pawn`、`Character`）或完整类路径（如 `/Script/Engine.Actor`）。
- 若蓝图已存在，返回 `code: 409` 冲突错误，需先删除或使用 `blueprint.add_component` 修改。
- `components` 数组中每个组件会按顺序添加，`attach_to` 可指定父组件名称，留空或 `root` 则附加到根节点。
- 创建完成后自动保存到磁盘并注册到 AssetRegistry。

---

## 为蓝图添加组件 `blueprint.add_component`
为已存在的蓝图资产添加新组件，支持设置组件变换和属性。组件会被添加到蓝图的 SimpleConstructionScript 中。

### 请求（JSON-RPC）
```json
{"ver":"1.0","type":"req","id":"bp2","method":"blueprint.add_component","params":{
  "blueprint_name":"BP_MyActor",    // 必填，蓝图名称或完整路径
  "component_type":"PointLightComponent", // 必填，组件类型
  "component_name":"MyLight",       // 必填，组件名称
  "attach_to":"MyMesh",             // 可选，附加到的父组件名称（默认 root）
  "location":{"x":0,"y":0,"z":200}, // 可选，相对位置
  "rotation":{"pitch":0,"yaw":0,"roll":0}, // 可选，相对旋转
  "scale":{"x":1,"y":1,"z":1},      // 可选，相对缩放
  "component_properties":{          // 可选，组件属性
    "Intensity":5000,
    "LightColor":"(R=1,G=0.8,B=0.6,A=1)"
  }
}}
```

### 响应
```json
{"ver":"1.0","type":"res","id":"bp2","code":200,"result":{
  "ok":true,
  "blueprint_name":"BP_MyActor",
  "blueprint_path":"/Game/Blueprints/BP_MyActor.BP_MyActor",
  "component_name":"MyLight",
  "component_class":"PointLightComponent",
  "attached":true,
  "saved":true,
  "message":"Successfully added component 'MyLight' (PointLightComponent) to blueprint 'BP_MyActor'"
}}
```

### 说明
- `blueprint_name` 支持短名（如 `BP_MyActor`）或完整路径（如 `/Game/Blueprints/BP_MyActor`）。
- 若蓝图不存在返回 `code: 404`；若组件名称已存在返回 `code: 409`。
- 仅 SceneComponent 及其子类支持 `location`、`rotation`、`scale` 设置。
- `attach_to` 留空或设为 `root`/`DefaultSceneRoot` 则附加到根节点。
- 添加完成后自动标记蓝图已修改并保存。

---

## 设置蓝图属性 `blueprint.set_property`
修改蓝图资产的属性，支持两种模式：
1. **CDO 模式**：`component_name` 为空时，修改蓝图类的默认值（Class Default Object）
2. **SCS 模式**：`component_name` 有值时，修改蓝图中指定组件的属性

### 请求（JSON-RPC）
```json
{"ver":"1.0","type":"req","id":"bp3","method":"blueprint.set_property","params":{
  "blueprint_path":"/Game/Blueprints/BP_Hero", // 必填，蓝图路径
  "component_name":"PointLight",   // 可选，为空则修改 CDO，有值则修改组件
  "properties":{                   // 必填，属性键值对
    "Intensity":5000,
    "LightColor":{"r":1,"g":0.8,"b":0.6}
  },
  "auto_compile":true              // 可选，默认 true
}}
```

### 响应
```json
{"ver":"1.0","type":"res","id":"bp3","code":200,"result":{
  "ok":true,
  "blueprint_path":"/Game/Blueprints/BP_Hero.BP_Hero",
  "blueprint_name":"BP_Hero",
  "target_type":"component",
  "component_name":"PointLight",
  "modified_properties":[
    {"property":"Intensity","type":"FloatProperty"},
    {"property":"LightColor","type":"StructProperty"}
  ],
  "failed_properties":[],
  "compiled":true,
  "saved":true,
  "message":"Successfully set 2 properties on component 'PointLight'"
}}
```

### 说明
- `blueprint_path` 支持短名或完整路径，会自动在 AssetRegistry 中查找。
- 属性名需与 UE 中的属性名完全匹配（大小写敏感），失败时会返回建议属性名。
- 支持的数据类型：基础类型（int/float/bool/string）、枚举、结构体（FVector/FRotator/FColor等）、对象引用。
- 颜色属性：使用 0-1 浮点数格式 `{r,g,b,a}`，会自动转换为 0-255 格式。
- 返回码：`200` 全部成功，`207` 部分成功，`400` 全部失败，`404` 蓝图或组件未找到。

