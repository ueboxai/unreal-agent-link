# æ¨¡å‹å¯¼å…¥ä¼˜åŒ–æ–¹æ¡ˆ - Quixelé£æ ¼è‡ªåŠ¨åŒ–å¯¼å…¥

## ğŸ“‹ æ”¹è¿›æ¦‚è¿°

æœ¬æ¬¡ä¼˜åŒ–å°†æ’ä»¶çš„æ¨¡å‹å¯¼å…¥æ–¹å¼ä»ç®€å•çš„ `AssetTools.ImportAssets()` å‡çº§ä¸º **Quixel Bridge** é£æ ¼çš„è‡ªåŠ¨åŒ–å¯¼å…¥æµç¨‹ï¼Œä½¿ç”¨ `UAssetImportTask` å®ç°ã€‚

---

## âœ… å·²å®Œæˆæ”¹è¿›ï¼ˆç¬¬ä¸€é˜¶æ®µï¼‰

### æ ¸å¿ƒå˜æ›´

#### 1. **æ— å¼¹çª—è‡ªåŠ¨å¯¼å…¥**
```cpp
Task->bAutomated = true;  // ç¦ç”¨æ‰€æœ‰UIå¼¹çª—
Task->bSave = true;        // è‡ªåŠ¨ä¿å­˜
Task->bReplaceExisting = bOverwrite;
```

#### 2. **FBXæ–‡ä»¶è‡ªåŠ¨é…ç½®**
```cpp
if (Extension == TEXT("fbx"))
{
    UFbxImportUI* ImportUI = NewObject<UFbxImportUI>();
    
    // ç¦ç”¨è‡ªåŠ¨æ£€æµ‹ï¼Œæ˜ç¡®æŒ‡å®šä¸ºé™æ€ç½‘æ ¼ä½“
    ImportUI->bAutomatedImportShouldDetectType = false;
    ImportUI->MeshTypeToImport = FBXIT_StaticMesh;
    
    // è‡ªåŠ¨å¯¼å…¥æè´¨å’Œçº¹ç†
    ImportUI->bImportMaterials = true;
    ImportUI->bImportTextures = true;
    
    // é™æ€ç½‘æ ¼ä½“è®¾ç½®
    ImportUI->StaticMeshImportData->bAutoGenerateCollision = true;
    ImportUI->StaticMeshImportData->bCombineMeshes = true;
    
    Task->Options = ImportUI;
}
```

#### 3. **æ‰¹é‡å¯¼å…¥ä»»åŠ¡**
```cpp
AssetTools.ImportAssetTasks(ImportTasks);  // æ›¿ä»£äº† ImportAssets()
```

---

## ğŸ¯ å½“å‰æ•ˆæœ

| ç‰¹æ€§ | æ—§æ–¹å¼ | **æ–°æ–¹å¼ï¼ˆå·²å®ç°ï¼‰** |
|------|--------|-------------------|
| **UIå¼¹çª—** | âŒ å¯èƒ½å¼¹å‡º | âœ… **å®Œå…¨ç¦ç”¨** |
| **FBXé…ç½®** | âŒ ä½¿ç”¨é»˜è®¤è®¾ç½® | âœ… **è‡ªåŠ¨é…ç½®å¯¼å…¥é€‰é¡¹** |
| **æè´¨å¯¼å…¥** | âš ï¸ å¼•æ“é»˜è®¤ | âœ… **è‡ªåŠ¨å¯¼å…¥æè´¨å’Œçº¹ç†** |
| **æ‰¹é‡å¤„ç†** | âœ… æ”¯æŒ | âœ… **æ”¹ç”¨Taskæœºåˆ¶** |
| **ç¢°æ’ç”Ÿæˆ** | âŒ éœ€æ‰‹åŠ¨ | âœ… **è‡ªåŠ¨ç”Ÿæˆç¢°æ’** |

---

## ğŸš€ è¿›é˜¶æ”¹è¿›æ–¹å‘ï¼ˆå¯é€‰çš„ç¬¬äºŒé˜¶æ®µï¼‰

å¦‚æœæ‚¨å¸Œæœ›è¿›ä¸€æ­¥å®ç° **Quixelçº§åˆ«çš„PBRæè´¨è‡ªåŠ¨ç”Ÿæˆ**ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æ–¹å‘ï¼š

### æ–¹æ¡ˆAï¼šåŸºäºå‘½åè§„åˆ™çš„æ™ºèƒ½æè´¨ç”Ÿæˆ

Quixelçš„æ ¸å¿ƒæŠ€æœ¯æ˜¯è¯†åˆ«çº¹ç†å‘½åæ¨¡å¼ï¼Œä¾‹å¦‚ï¼š
- `Hero_Albedo.png`
- `Hero_Normal.png`
- `Hero_Roughness.png`
- `Hero_Metallic.png`
- `Hero_AO.png`

**å®ç°æ­¥éª¤ï¼š**
1. å¯¼å…¥å®Œæˆåï¼Œæ‰«æå¯¼å…¥çš„çº¹ç†èµ„äº§
2. ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æˆ–å‘½åçº¦å®šè¯†åˆ«è´´å›¾ç±»å‹
3. è‡ªåŠ¨åˆ›å»º `UMaterialInstanceConstant`
4. å°†è¯†åˆ«çš„è´´å›¾è‡ªåŠ¨è¿æ¥åˆ°PBR Master Material

### æ–¹æ¡ˆBï¼šè‡ªå®šä¹‰å¯¼å…¥Factory

åˆ›å»ºç»§æ‰¿è‡ª `UFbxFactory` çš„è‡ªå®šä¹‰Factoryï¼š
- å®Œå…¨æ§åˆ¶å¯¼å…¥æµç¨‹
- åœ¨å¯¼å…¥è¿‡ç¨‹ä¸­è‡ªåŠ¨åˆ›å»ºå’Œé…ç½®æè´¨
- å®ç°è‡ªå®šä¹‰å‘½åè§„èŒƒ

### æ–¹æ¡ˆCï¼šåç½®å¤„ç†Hook

ä½¿ç”¨ `FAssetEditorManager` æˆ– `AssetTools` çš„å›è°ƒï¼š
- ç›‘å¬èµ„äº§å¯¼å…¥å®Œæˆäº‹ä»¶
- è‡ªåŠ¨æ‰§è¡Œæè´¨åˆ›å»ºå’Œé…ç½®
- åº”ç”¨é¡¹ç›®ç‰¹å®šçš„æ ‡å‡†

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### TypeScriptè°ƒç”¨ï¼ˆæ— å˜åŒ–ï¼‰
```typescript
const result = await wsService.callRequest('content.import', {
  files: ['C:/Downloads/Hero.fbx', 'C:/Downloads/Texture_Albedo.png'],
  destination_path: '/Game/Characters/Hero',
  overwrite: false
});
```

### é¢„æœŸæ•ˆæœ
1. âœ… **æ— å¼¹çª—** - ä¸ä¼šå‡ºç°ä»»ä½•å¯¼å…¥ç¡®è®¤å¯¹è¯æ¡†
2. âœ… **è‡ªåŠ¨é…ç½®** - FBXæ–‡ä»¶è‡ªåŠ¨ä½¿ç”¨ä¼˜åŒ–çš„å¯¼å…¥è®¾ç½®
3. âœ… **æè´¨å¯¼å…¥** - è‡ªåŠ¨å¯¼å…¥FBXå†…åµŒçš„æè´¨å’Œçº¹ç†
4. âœ… **ç¢°æ’ç”Ÿæˆ** - è‡ªåŠ¨ç”Ÿæˆç¢°æ’ç½‘æ ¼

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### å…³é”®APIå˜æ›´

#### æ—§ä»£ç 
```cpp
TArray<UObject*> ImportedAssets = AssetTools.ImportAssets(FilesToImport, DestinationPath);
```

#### æ–°ä»£ç 
```cpp
// 1. åˆ›å»ºä»»åŠ¡
UAssetImportTask* Task = NewObject<UAssetImportTask>();
Task->Filename = FilePath;
Task->DestinationPath = DestinationPath;
Task->bAutomated = true;  // æ ¸å¿ƒï¼šç¦ç”¨UI

// 2. é…ç½®é€‰é¡¹ï¼ˆé’ˆå¯¹FBXï¼‰
UFbxImportUI* ImportUI = NewObject<UFbxImportUI>();
ImportUI->bAutomatedImportShouldDetectType = false;
ImportUI->MeshTypeToImport = FBXIT_StaticMesh;
ImportUI->bImportMaterials = true;
Task->Options = ImportUI;

// 3. æ‰§è¡Œæ‰¹é‡å¯¼å…¥
AssetTools.ImportAssetTasks(ImportTasks);

// 4. ä»Taskè·å–ç»“æœ
Task->ImportedObjectPaths  // å¯¼å…¥çš„èµ„äº§è·¯å¾„åˆ—è¡¨
```

### æ·»åŠ çš„å¤´æ–‡ä»¶
```cpp
#include "AssetImportTask.h"
#include "Factories/FbxImportUI.h"
```

---

## ğŸ¨ Quixelå®Œæ•´å®ç°éœ€è¦ä»€ä¹ˆï¼Ÿ

è¦è¾¾åˆ° **å®Œå…¨çš„Quixelæ°´å¹³**ï¼Œè¿˜éœ€è¦ï¼š

### 1. **æ™ºèƒ½çº¹ç†è¯†åˆ«ç³»ç»Ÿ**
```cpp
// ä¼ªä»£ç ç¤ºä¾‹
TMap<FString, UTexture2D*> ClassifyTextures(const TArray<UTexture2D*>& Textures)
{
    TMap<FString, UTexture2D*> ClassifiedTextures;
    
    for (UTexture2D* Texture : Textures)
    {
        FString Name = Texture->GetName().ToLower();
        
        if (Name.Contains("albedo") || Name.Contains("diffuse"))
            ClassifiedTextures.Add("Albedo", Texture);
        else if (Name.Contains("normal"))
            ClassifiedTextures.Add("Normal", Texture);
        else if (Name.Contains("rough"))
            ClassifiedTextures.Add("Roughness", Texture);
        // ... å…¶ä»–ç±»å‹
    }
    
    return ClassifiedTextures;
}
```

### 2. **PBRæè´¨å®ä¾‹è‡ªåŠ¨ç”Ÿæˆ**
```cpp
UMaterialInstanceConstant* CreatePBRMaterial(
    const FString& AssetName,
    const TMap<FString, UTexture2D*>& Textures,
    UMaterial* MasterMaterial)
{
    // åˆ›å»ºæè´¨å®ä¾‹
    UMaterialInstanceConstant* MatInst = CreateAsset<UMaterialInstanceConstant>(
        DestinationPath, AssetName + "_Mat");
    
    MatInst->SetParentEditorOnly(MasterMaterial);
    
    // è®¾ç½®çº¹ç†å‚æ•°
    if (Textures.Contains("Albedo"))
        MatInst->SetTextureParameterValueEditorOnly("AlbedoTexture", Textures["Albedo"]);
    
    if (Textures.Contains("Normal"))
        MatInst->SetTextureParameterValueEditorOnly("NormalTexture", Textures["Normal"]);
    
    // ... è®¾ç½®å…¶ä»–å‚æ•°
    
    return MatInst;
}
```

### 3. **æ ‡å‡†åŒ–å‘½åç³»ç»Ÿ**
```cpp
FString StandardizeName(const FString& OriginalName, const FString& AssetType)
{
    // ç¤ºä¾‹ï¼šT_Hero_Albedo, SM_Hero, M_Hero_Inst
    FString Prefix;
    if (AssetType == "Texture") Prefix = "T_";
    else if (AssetType == "StaticMesh") Prefix = "SM_";
    else if (AssetType == "Material") Prefix = "M_";
    
    return Prefix + CleanName(OriginalName);
}
```

---

## ğŸ’¬ ä¸‹ä¸€æ­¥å»ºè®®

### é€‰é¡¹1ï¼šä¿æŒå½“å‰å®ç°ï¼ˆæ¨èï¼‰
- å½“å‰çš„æ”¹è¿›å·²ç»è§£å†³äº†**å¼¹çª—é—®é¢˜**
- FBX**è‡ªåŠ¨å¯¼å…¥æè´¨å’Œçº¹ç†**
- æ»¡è¶³å¤§éƒ¨åˆ†è‡ªåŠ¨åŒ–éœ€æ±‚

### é€‰é¡¹2ï¼šå®ç°å®Œæ•´çš„PBRè‡ªåŠ¨ç”Ÿæˆ
å¦‚æœæ‚¨éœ€è¦ï¼š
1. åˆ›å»ºä¸€ä¸ª **PBR Master Material**
2. å®ç° **`content.import_pbr`** æ–°å‘½ä»¤ï¼ŒåŒ…å«ï¼š
   - çº¹ç†åˆ†ç±»ç®—æ³•
   - è‡ªåŠ¨æè´¨å®ä¾‹åˆ›å»º
   - æ ‡å‡†åŒ–å‘½å
3. å°†æè´¨è‡ªåŠ¨åº”ç”¨åˆ°å¯¼å…¥çš„æ¨¡å‹

### é€‰é¡¹3ï¼šæ··åˆæ–¹æ¡ˆ
- ä¿ç•™å½“å‰çš„ `content.import`ï¼ˆé€šç”¨å¯¼å…¥ï¼‰
- æ–°å¢ `content.import_pbr`ï¼ˆQuixelé£æ ¼PBRå¯¼å…¥ï¼‰
- è®©ç”¨æˆ·æ ¹æ®éœ€æ±‚é€‰æ‹©ä½¿ç”¨å“ªä¸ª

---

## ğŸ“š å‚è€ƒèµ„æ–™

- **Unreal Engineæ–‡æ¡£**: [UAssetImportTask](https://docs.unrealengine.com/5.3/en-US/API/Editor/UnrealEd/AssetImportTask/)
- **FBXå¯¼å…¥**: [UFbxImportUI](https://docs.unrealengine.com/5.3/en-US/API/Editor/UnrealEd/Factories/FbxImportUI/)
- **AssetTools**: [IAssetTools::ImportAssetTasks](https://docs.unrealengine.com/5.3/en-US/API/Developer/AssetTools/IAssetTools/ImportAssetTasks/)

---

**ä½œè€…ï¼š** Antigravity AI Assistant  
**æ—¥æœŸï¼š** 2025-12-11  
**ç‰ˆæœ¬ï¼š** v1.0 - åŸºç¡€è‡ªåŠ¨åŒ–å¯¼å…¥å®ç°
