# 关卡工具接口

## 多维资产查询 `level.query_assets`
对场景或项目中的资产进行多维度查询和性能分析，返回“罪证”与优化建议，便于技术美术排查。

### 协议定义
```json
{
  "method": "level.query_assets",
  "description": "对场景或项目中的资产进行多维度查询和性能分析。",
  "params": {
    "scope": {                 // 范围
      "type": "Level | ContentBrowser | Selection",
      "path": "/Game/Props"    // 可选，限制文件夹
    },
    "conditions": {            // 查询条件（可组合）
      "min_triangles": 50000,
      "min_texture_size": 2048,
      "max_texture_size": 0,
      "shader_complexity_index": 0,
      "missing_collision": true,
      "nanite_enabled": false,
      "shadow_casting": true,
      "class_filter": "StaticMeshActor"
    },
    "sort_by": "TriangleCount | TextureMemory | DiskSize",
    "limit": 20
  }
}
```

### 响应（带智能建议）
```json
{
  "code": 200,
  "result": {
    "count": 5,
    "assets": [
      {
        "name": "SM_CoffeeCup",
        "path": "/Game/Props/SM_CoffeeCup.SM_CoffeeCup",
        "type": "StaticMesh",
        "stats": {
          "triangles": 120000,
          "texture_res": "4096 x 4096",
          "nanite": false
        },
        "suggestion": "High poly count (120k) for a small object. Consider enabling Nanite or reducing LOD."
      }
    ]
  }
}
```

### 高级玩法示例
- **垃圾资产猎人**：查高面数且未开启 Nanite 的静态网格  
  ```json
  {
    "conditions": {
      "min_triangles": 100000,
      "nanite_enabled": false,
      "class_filter": "StaticMeshActor"
    }
  }
  ```
- **显存杀手定位**：按纹理显存排序，取 Top N  
  ```json
  { "scope": { "type": "Level" }, "sort_by": "TextureMemory", "limit": 10 }
  ```
- **碰撞体检查**：查缺失碰撞的选中对象或特定命名物  
  ```json
  { "scope": { "type": "Selection" }, "conditions": { "missing_collision": true } }
  ```
- **光影优化**：筛大半径且投射阴影的灯光  
  ```json
  {
    "conditions": {
      "class_filter": "PointLight",
      "shadow_casting": true,
      "min_radius": 5000
    }
  }
  ```

### 前端可视化建议
- Query Builder 拖拽式组合条件，生成 JSON 调用。
- 结果卡片展示缩略图与“罪证”文本，支持一键修复（调用 `actor.set_property` 等）。

### 提示
- 这是接口契约文档，具体查询/统计逻辑需后端实现（如三角面数、贴图尺寸、Nanite 状态、碰撞体检测、材质复杂度等）。可分阶段支持：先实现核心指标，再逐步补齐高级字段。 

